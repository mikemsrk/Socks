angular.module("vizu.ctrl",["ngFx","ngAnimate"]).controller("vizuCtrl",["$scope","reqs",function(a,b){a.data=[],a.details=[],a.showDetail=!1,a.startDate="2015-01-01",a.endDate="2015-01-15";var c=1e6,d=1;a.sendForm=function(){a.showDetail=!1,b.getData({startDate:a.startDate,endDate:a.endDate,stocks:a.stocks}).then(function(b){for(var e=b.data,f=0;f<e.length;f++)e[f].Volume=e[f].Volume/c,e[f].Close=e[f].Close/d,e[f].Date=parseInt(e[f].Date.slice(-2));a.data=e,a.render(e)})},a.getDetail=function(){b.getData({startDate:a.startDate,endDate:a.endDate,stocks:a.searchText}).then(function(b){var c=b.data;a.renderDetail(c)})},a.renderDetail=function(b,c){$("svg").remove(),a.details=b,a.showDetail=!0},a.render=function(a){var b=$("svg");if(!b.length){var c=$('<svg id="svgVisualize" width="1000" height="1000" style="margin:auto auto"></svg>');$("#container").append(c)}var d=d3.select("#svgVisualize");d.selectAll("g").remove();var e=d3.scale.linear().range([40,800]).domain([d3.min(a,function(a){return a.Date}),d3.max(a,function(a){return a.Date})]),f=d3.scale.linear().range([40,500]).domain([d3.max(a,function(a){return a.Close}),d3.min(a,function(a){return a.Close})]),g=d.selectAll("g").data(a).enter().append("g"),h=(g.append("circle").attr("r",0).transition().duration(200).attr("r",function(a){return a.Volume/3}).attr("cx",function(a){return e(a.Date)}).attr("cy",function(a){return f(a.Close)}).attr("stroke","black").attr("fill","white").style("fill",function(a){return"hsl("+10*a.Close+",100%,50%)"}),g.append("text").attr("text-anchor","middle").attr("dx",function(a){return e(a.Date)}).attr("dy",function(a){return f(a.Close)}).text(function(a){return a.Symbol}),d3.svg.axis().scale(e)),i=d3.svg.axis().scale(f).orient("left");d.append("svg:g").call(h).attr("transform","translate(0,500)").append("text").attr("transform","translate(400,50)").text("Days"),d.append("svg:g").call(i).attr("transform","translate(40,0)").append("text").attr("transform","translate(0,20)").text("Price")}}]),angular.module("vizu.reqs",[]).factory("reqs",["$http",function(a){var b=function(b){return a({method:"POST",url:"/data",data:b})};return{getData:b}}]),angular.module("vizu",["ui.router","vizu.ctrl","vizu.reqs","ngAnimate","ngFx"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"views/view.html",controller:"vizuCtrl"})}]);